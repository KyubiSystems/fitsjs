// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},m={}.hasOwnProperty,g=function(e,t){function r(){this.constructor=e}for(var n in t)m.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},y=[].slice,b=function(e,t){return function(){return e.apply(t,arguments)}};this.astro==null&&(this.astro={}),p={},p.version="0.2.0",this.astro.fits=p,d=["included","extended"],l=function(){function e(){}return e.include=function(e){var t,n,r;if(!e)throw"include(obj) requires obj";for(t in e)n=e[t],v.call(d,t)<0&&(this.prototype[t]=n);return(r=e.included)!=null&&r.apply(this),this},e.extend=function(e){var t,n,r;if(!e)throw"extend(obj) requires obj";for(t in e)n=e[t],v.call(d,t)<0&&(this[t]=n);return(r=e.extended)!=null&&r.apply(this),this},e.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e.prototype.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e}(),this.astro.fits.Module=l,n=function(e){function t(e,t){this.view=e,this.begin=this.current=e.tell(),this.length=void 0}return g(t,e),t}(l),this.astro.fits.DataUnit=n,u={verifyOrder:function(e,t){if(t!==this.cardIndex)return console.warn(""+e+" should appear at index "+this.cardIndex+" in the FITS header")},verifyBetween:function(e,t,n,r){if(!(t>=n&&t<=r))throw"The "+e+" value of "+t+" is not between "+n+" and "+r},verifyBoolean:function(e){return e==="T"?!0:!1},Functions:{SIMPLE:function(){var e,t;return e=1<=arguments.length?y.call(arguments,0):[],t=arguments[0],this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(t)},XTENSION:function(){var e,t;return e=1<=arguments.length?y.call(arguments,0):[],t=arguments[0],this.extension=!0,this.extensionType=t,this.verifyOrder("XTENSION",0),t},BITPIX:function(){var e,t,n;e=1<=arguments.length?y.call(arguments,0):[],t="BITPIX",n=parseInt(arguments[0]),this.verifyOrder(t,1);if(n!==8&&n!==16&&n!==32&&n!==64&&n!==-32&&n!==-64)throw""+t+" value "+n+" is not permitted";return n},NAXIS:function(){var e,t,n,r,i,s;e=1<=arguments.length?y.call(arguments,0):[],n="NAXIS",i=parseInt(arguments[0]),t=arguments[1];if(!t){this.verifyOrder(n,2),this.verifyBetween(n,i,0,999);if(this.isExtension())if((s=this.extensionType)==="TABLE"||s==="BINTABLE"){r=2;if(i!==r)throw""+n+" must be "+r+" for TABLE and BINTABLE extensions"}}return i},PCOUNT:function(){var e,t,n,r,i,s;e=1<=arguments.length?y.call(arguments,0):[],t="PCOUNT",i=parseInt(arguments[0]),n=3+this.NAXIS,this.verifyOrder(t,n);if(this.isExtension())if((s=this.extensionType)==="IMAGE"||s==="TABLE"){r=0;if(i!==r)throw""+t+" must be "+r+" for the "+this.extensionType+" extensions"}return i},GCOUNT:function(){var e,t,n,r,i,s;e=1<=arguments.length?y.call(arguments,0):[],t="GCOUNT",i=parseInt(arguments[0]),n=3+this.NAXIS+1,this.verifyOrder(t,n);if(this.isExtension())if((s=this.extensionType)==="IMAGE"||s==="TABLE"||s==="BINTABLE"){r=1;if(i!==r)throw""+t+" must be "+r+" for the "+this.extensionType+" extensions"}return i},EXTEND:function(){var e,t,n;e=1<=arguments.length?y.call(arguments,0):[],t="EXTEND",n=arguments[0];if(!this.isPrimary())throw""+t+" must only appear in the primary header";return this.verifyBoolean(n)},BSCALE:function(){var e;return e=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){var e;return e=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var e,t,n;e=1<=arguments.length?y.call(arguments,0):[],t="BLANK",n=arguments[0];if(this.BIXPIX>0)return parseInt(n);throw""+t+" is not to be used for BITPIX = "+this.BITPIX},DATAMIN:function(){var e;return e=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){var e;return e=1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var e,t,n;return e=1<=arguments.length?y.call(arguments,0):[],t="EXTVER",n=arguments[0],n=parseInt(n),n},EXTLEVEL:function(){var e,t,n;return e=1<=arguments.length?y.call(arguments,0):[],t="EXTLEVEL",n=arguments[0],n=parseInt(n),n},TFIELDS:function(){var e,t,n;return e=1<=arguments.length?y.call(arguments,0):[],t="TFIELDS",n=arguments[0],n=parseInt(n),this.verifyBetween(t,n,0,999),n},TBCOL:function(){var e,t,n,r;return e=1<=arguments.length?y.call(arguments,0):[],n="TBCOL",r=arguments[0],t=arguments[2],this.verifyBetween(n,t,0,this.TFIELDS),r},ZIMAGE:function(){var e,t,n;return e=1<=arguments.length?y.call(arguments,0):[],t="ZIMAGE",n=arguments[0],this.verifyBoolean(n)},ZCMPTYPE:function(){var e,t,n;e=1<=arguments.length?y.call(arguments,0):[],t="ZCMPTYPE",n=arguments[0];if(n!=="GZIP_1"&&n!=="RICE_1"&&n!=="PLIO_1"&&n!=="HCOMPRESS_1")throw""+t+" value "+n+" is not permitted";if(n!=="RICE_1"&&n!=="GZIP_1")throw"Compress type "+n+" is not yet implement";return n},ZBITPIX:function(){var e,t,n;e=1<=arguments.length?y.call(arguments,0):[],t="ZBITPIX",n=parseInt(arguments[0]);if(n!==8&&n!==16&&n!==32&&n!==64&&n!==-32&&n!==-64)throw""+t+" value "+n+" is not permitted";return n},ZNAXIS:function(){var e,t,n,r;return e=1<=arguments.length?y.call(arguments,0):[],n="ZNAXIS",r=parseInt(arguments[0]),t=arguments[1],r=r,t||this.verifyBetween(n,r,0,999),r},ZTILE:function(){var e,t;return e=1<=arguments.length?y.call(arguments,0):[],t="ZTILE",parseInt(arguments[0])},ZSIMPLE:function(){var e;return e=1<=arguments.length?y.call(arguments,0):[],arguments[0]==="T"?!0:!1},ZPCOUNT:function(){var e,t;return e=1<=arguments.length?y.call(arguments,0):[],t="ZPCOUNT",parseInt(arguments[0])},ZGCOUNT:function(){var e,t;return e=1<=arguments.length?y.call(arguments,0):[],t="ZGCOUNT",parseInt(arguments[0])}}},this.astro.fits.HeaderVerify=u,o=function(e){function t(){this.init=b(this.init,this);var e,t,n;this.primary=!1,this.extension=!1,this.verifyCard={},n=this.Functions;for(t in n)e=n[t],this.verifyCard[t]=this.proxy(e);this.cards={},this.cardIndex=0}return g(t,e),t.keywordPattern=/^([A-Z0-9_-]+)\s*=\s*(.*)/,t.nonStringPattern=/([^\/]*)\s*\/*(.*)/,t.stringPattern=/'(.*)'\s*\/*(.*)/,t.arrayPattern=/([A-Za-z]+)(\d+)/,t.include(u),t.prototype.get=function(e){return this.contains(e)?this.cards[e]:console.warn("Header does not contain the key "+e)},t.prototype.getIndex=function(e){return this.contains(e)?this.cards[e][0]:console.warn("Header does not contain the key "+e)},t.prototype.getComment=function(e){return this.contains(e)?this.cards[e][2]!=null?this.cards[e][2]:console.warn(""+e+" does not contain a comment"):console.warn("Header does not contain the key "+e)},t.prototype.getComments=function(){return this.contains("COMMENT")?this.cards.COMMENT:console.warn("Header does not contain any COMMENT fields")},t.prototype.getHistory=function(){return this.contains("HISTORY")?this.cards.HISTORY:console.warn("Header does not contain any HISTORY fields")},t.prototype.set=function(e,t,n){return this.cards[e]=n?[this.cardIndex,t,n]:[this.cardIndex,t],this.cardIndex+=1},t.prototype.setComment=function(e){return this.contains("COMMENT")||(this.cards.COMMENT=[],this.cardIndex+=1),this.cards.COMMENT.push(e)},t.prototype.setHistory=function(e){return this.contains("HISTORY")||(this.cards.HISTORY=[],this.cardIndex+=1),this.cards.HISTORY.push(e)},t.prototype.contains=function(e){return this.cards.hasOwnProperty(e)},t.prototype.readCard=function(e){var n,r,i,s,o,u,a,f,l,c,h,p;u=e.match(t.keywordPattern);if(u==null)return;f=u.slice(1),s=f[0],a=f[1],s==="COMMENT"||s==="HISTORY"?u[1]=a.trim():a[0]==="'"?(u=a.match(t.stringPattern),u[1]=u[1].trim()):(u=a.match(t.nonStringPattern),u[1]=(l=u[1][0])==="T"||l==="F"?u[1].trim():parseFloat(u[1])),u[2]=u[2].trim(),c=u.slice(1),a=c[0],r=c[1],o=s,h=[!1,void 0],n=h[0],i=h[1],u=s.match(t.arrayPattern),u!=null&&(o=u[1],p=[!0,u[2]],n=p[0],i=p[1]),this.verifyCard.hasOwnProperty(o)&&(a=this.verifyCard[o](a,n,i));switch(s){case"COMMENT":return this.setComment(a);case"HISTORY":return this.setHistory(a);default:return this.set(s,a,r),this.__defineGetter__(s,function(){return this.cards[s][1]})}},t.prototype.init=function(e){var t,n,r,i,s,o,u,a;r=80,s=e.length/r,i=600,s=s<i?s:i,a=[];for(t=o=0,u=s-1;0<=u?o<=u:o>=u;t=0<=u?++o:--o)n=e.slice(t*r,(t+1)*r),a.push(this.readCard(n));return a},t.prototype.hasDataUnit=function(){return this.NAXIS===0?!1:!0},t.prototype.isPrimary=function(){return this.primary},t.prototype.isExtension=function(){return this.extension},t}(l),this.astro.fits.Header=o,f={initArray:function(e){return this.data=new e(this.width*this.height)},getExtremes:function(){var e,t,n,r,i,s;if(this.min!=null&&this.max!=null)return[this.min,this.max];e=this.data.length;while(e--){r=this.data[e];if(isNaN(r))continue;i=[r,r],n=i[0],t=i[1];break}while(e--){r=this.data[e];if(isNaN(r))continue;r<n&&(n=r),r>t&&(t=r)}return s=[n,t],this.min=s[0],this.max=s[1],[this.min,this.max]},getPixel:function(e,t){return this.data[t*this.width+e]}},this.astro.fits.ImageUtils=f,a=function(e){function t(e,n){var r,i,s,o,u=this;t.__super__.constructor.apply(this,arguments),s=n.NAXIS,r=n.BITPIX,this.naxis=[];for(i=o=1;1<=s?o<=s:o>=s;i=1<=s?++o:--o)this.naxis.push(n["NAXIS"+i]);this.width=n.NAXIS1,this.height=n.NAXIS2||1,this.rowByteSize=this.width*Math.abs(r)/8,this.totalRowsRead=0,this.length=this.naxis.reduce(function(e,t){return e*t})*Math.abs(r)/8,this.data=void 0,this.frame=0;switch(r){case 8:this.arrayType=Uint8Array,this.accessor=function(){return u.view.getUint8()};break;case 16:this.arrayType=Int16Array,this.accessor=function(){return u.view.getInt16()};break;case 32:this.arrayType=Int32Array,this.accessor=function(){return u.view.getInt32()};break;case 64:this.arrayType=Int32Array,console.warn("Something funky happens here when dealing with 64 bit integers.  Be wary!!!"),this.accessor=function(){var e,t,n,r,i;return t=Math.abs(u.view.getInt32()),n=Math.abs(u.view.getInt32()),r=t%10,e=r?-1:1,t-=r,i=e*(t<<32|n),i};break;case-32:this.arrayType=Float32Array,this.accessor=function(){return u.view.getFloat32()};break;case-64:this.arrayType=Float64Array,this.accessor=function(){return u.view.getFloat64()};break;default:throw"FITS keyword BITPIX does not conform to one of the following set values [8, 16, 32, 64, -32, -64]"}}return g(t,e),t.include(f),t.prototype.getRow=function(){var e,t,n;this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current);for(e=t=0,n=this.width-1;0<=n?t<=n:t>=n;e=0<=n?++t:--t)this.data[this.width*this.rowsRead+e]=this.accessor();return this.rowsRead+=1,this.totalRowsRead+=1},t.prototype.getFrame=function(e){var t;this.frame=e!=null?e:this.frame,this.data==null&&this.initArray(this.arrayType),this.totalRowsRead=this.width*this.frame,this.rowsRead=0,t=this.height;while(t--)this.getRow();return this.frame+=1,this.data},t.prototype.seek=function(e){return e==null&&(e=0),this.naxis.length===2?(this.totalRowsRead=0,this.frame=0):(this.totalRowsRead=this.height*e,this.frame=this.height/this.totalRowsRead-1)},t.prototype.isDataCube=function(){return this.naxis.length>2?!0:!1},t}(n),this.astro.fits.Image=a,h=function(e){function t(e,n){this.getRow=b(this.getRow,this),t.__super__.constructor.apply(this,arguments),this.rowByteSize=n.NAXIS1,this.rows=n.NAXIS2,this.cols=n.TFIELDS,this.length=this.tableLength=this.rowByteSize*this.rows,this.rowsRead=0,this.columns=this.getColumnNames(n),this.accessors=[]}return g(t,e),t.dataAccessors={L:function(e){return e.getInt8()===84?!0:!1},X:function(e){throw"Data type not yet implemented"},B:function(e){return e.getUint8()},I:function(e){return e.getInt16()},J:function(e){return e.getInt32()},K:function(e){var t,n,r,i,s;return n=Math.abs(e.getInt32()),r=Math.abs(e.getInt32()),i=n%10,t=i?-1:1,n-=i,s=t*(n<<32|r),console.warn("Something funky happens here when dealing with 64 bit integers.  Be wary!!!"),s},A:function(e){return e.getChar()},E:function(e){return e.getFloat32()},D:function(e){return e.getFloat64()},C:function(e){return[e.getFloat32(),e.getFloat32()]},M:function(e){return[e.getFloat64(),e.getFloat64()]}},t.prototype.getRow=function(e){var t,n,r,i,s;e==null&&(e=null),e!=null&&(this.rowsRead=e),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),e={},s=this.accessors;for(n=r=0,i=s.length;r<i;n=++r)t=s[n],e[this.columns[n]]=t();return this.rowsRead+=1,e},t.prototype.getColumnNames=function(e){var t,n,r,i,s;t=[];for(n=i=1,s=this.cols;1<=s?i<=s:i>=s;n=1<=s?++i:--i){r="TTYPE"+n;if(!e.contains(r))return null;t.push(e[r])}return t},t}(n),this.astro.fits.Tabular=h,c=function(e){function t(e,n){this.getRow=b(this.getRow,this);var r,i,s,o,u,a,f=this;t.__super__.constructor.apply(this,arguments),o=function(){var e,n,r,i,o;return o=s.slice(1),n=o[0],i=o[1],r=o[2],e=function(e){return t.dataAccessors[n](e)},f.accessors.push(e)};for(i=u=1,a=this.cols;1<=a?u<=a:u>=a;i=1<=a?++u:--u)r=n["TFORM"+i],s=r.match(t.formPattern),o()}return g(t,e),t.formPattern=/([AIFED])(\d+)\.*(\d+)*/,t.dataAccessors={A:function(e){return e.trim()},I:function(e){return parseInt(e)},F:function(e){return parseFloat(e)},E:function(e){return parseFloat(e)},D:function(e){return parseFloat(e)}},t.prototype.getRow=function(e){var t,n,r,i,s,o,u,a;e==null&&(e=null),e!=null&&(this.rowsRead=e),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),r="";for(t=s=1,a=this.rowByteSize;1<=a?s<=a:s>=a;t=1<=a?++s:--s)r+=this.view.getChar();r=r.trim().split(/\s+/),e={};for(n=o=0,u=r.length;o<u;n=++o)i=r[n],e[this.columns[n]]=this.accessors[n](i);return this.rowsRead+=1,e},t}(h),this.astro.fits.Table=c,e=function(e){function t(e,n){var r,i,s,o,u,a,f,l,c,h=this;t.__super__.constructor.apply(this,arguments);for(i=f=1,l=this.cols;1<=l?f<=l:f>=l;i=1<=l?++f:--f)s="TFORM"+i,a=n[s],u=a.match(t.arrayDescriptorPattern),u!=null?function(){var e,n;return n=u[1],e=function(){var e,r,s,o;r=h.view.getInt32(),s=h.view.getInt32(),h.current=h.view.tell(),h.view.seek(h.begin+h.tableLength+s),e=[];for(i=o=1;1<=r?o<=r:o>=r;i=1<=r?++o:--o)e.push(t.dataAccessors[n](h.view));return h.view.seek(h.current),e},h.accessors.push(e)}():(u=a.match(t.dataTypePattern),c=u.slice(1),o=c[0],r=c[1],o=o?parseInt(o):0,o===0||o===1?function(e){var n;return n=function(){var n;return n=t.dataAccessors[e](h.view),n},h.accessors.push(n)}(r):function(e,n){var r,s;return e==="X"?(s=Math.log(n)/Math.log(2),r=function(){var e,t,r,o,u,a,f,l;o=function(e){var t;t=[],i=128;while(i>=1)t.push(e&i?1:0),i/=2;return t},u=[];for(i=a=1;1<=s?a<=s:a>=s;i=1<=s?++a:--a){r=h.view.getUint8(),t=o(r);for(f=0,l=t.length;f<l;f++)e=t[f],u.push(e)}return u.slice(0,+(n-1)+1||9e9)}):e==="A"?r=function(){var r,s;r="";for(i=s=1;1<=n?s<=n:s>=n;i=1<=n?++s:--s)r+=t.dataAccessors[e](h.view);return r.trim()}:r=function(){var r,s;r=[];for(i=s=1;1<=n?s<=n:s>=n;i=1<=n?++s:--s)r.push(t.dataAccessors[e](h.view));return r},h.accessors.push(r)}(r,o))}return g(t,e),t.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,t.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,t}(h),this.astro.fits.BinaryTable=e,r={Rice:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;u=1<<l,w=this.RiceSetup[r](e),l=w[0],c=w[1],v=w[2],b=w[3],g=new Uint8Array(256),y=8,E=[128,255],d=E[0],h=E[1];while(h>=0){while(h>=d)g[h]=y,h-=1;d/=2,y-=1}g[0]=0,o=e[b],b+=1,m=8,h=0;while(h<s){m-=l;while(m<0)o=o<<8|e[b],b+=1,m+=8;f=(o>>m)-1,o&=(1<<m)-1,p=h+n,p>s&&(p=s);if(f<0)while(h<p)e[h]=v,h++;else if(f===c)while(h<p){d=u-m,a=o<<d,d-=8;while(d>=0)o=e[b],b+=1,a|=o<<d,d-=8;m>0?(o=e[b],b+=1,a|=o>>-d,o&=(1<<m)-1):o=0,(a&1)===0?a>>=1:a=~(a>>1),e[h]=a+v,v=e[h],h++}else while(h<p){while(o===0)m+=8,o=e[b],b+=1;y=m-g[o],m-=y+1,o^=1<<m,m-=f;while(m<0)o=o<<8|e[b],b+=1,m+=8;a=y<<f|o>>m,o&=(1<<m)-1,(a&1)===0?a>>=1:a=~(a>>1),i[h]=a+v,v=i[h],h++}}return i},RiceSetup:{1:function(e){var t,n,r,i;return i=0,t=3,n=6,r=e[i],i+=1,[t,n,r,i]},2:function(e){var t,n,r,i,s;return s=0,n=4,r=14,i=0,t=e[s],s+=1,i|=t<<8,t=e[s],s+=1,i|=t,[n,r,i,s]},4:function(e){var t,n,r,i,s;return s=0,n=5,r=25,i=0,t=e[s],s+=1,i|=t<<24,t=e[s],s+=1,i|=t<<16,t=e[s],s+=1,i|=t<<8,t=e[s],s+=1,i|=t,[n,r,i,s]}},gzip:function(e){throw"Not yet implemented"},plio:function(e,t){throw"Not yet implemented"},hcompress:function(e,t){throw"Not yet implemented"}},this.astro.fits.Decompress=r,t=function(e){function t(e,n){var r,i,s,o,u,a;t.__super__.constructor.apply(this,arguments),this.length+=n.PCOUNT,this.zcmptype=n.ZCMPTYPE,this.zbitpix=n.ZBITPIX,this.znaxis=n.ZNAXIS,this.zblank=t.setValue(n,"ZBLANK",void 0),this.blank=t.setValue(n,"BLANK",void 0),this.ztile=[];for(r=u=1,a=this.znaxis;1<=a?u<=a:u>=a;r=1<=a?++u:--u)o=n.contains("ZTILE"+r)?n["ZTILE"+r]:r===1?n.ZNAXIS1:1,this.ztile.push(o);this.width=n.ZNAXIS1,this.height=n.ZNAXIS2||1,this.algorithmParameters={},r=1;for(;;){i="ZNAME"+r;if(!n.contains(i))break;s="ZVAL"+r,this.algorithmParameters[n[i]]=n[s],r+=1}this.zcmptype==="RICE_1"&&this.setRiceDefaults(),this.zmaskcmp=t.setValue(n,"ZMASKCMP",void 0),this.zquantiz=t.setValue(n,"ZQUANTIZ","LINEAR_SCALING"),this.bzero=t.setValue(n,"BZERO",0),this.bscale=t.setValue(n,"BSCALE",1),this.defineColumnAccessors(n),this.defineGetRow()}return g(t,e),t.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,t.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,t.include(f),t.extend(r),t.typedArray={B:Uint8Array,I:Int16Array,J:Int32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint8Array,4:Int16Array,8:Int32Array},t.prototype.defineColumnAccessors=function(e){var n,r,i,s,o,u,a,f,l,c,h,p=this;this.columnNames={},h=[];for(i=f=1,l=this.cols;1<=l?f<=l:f>=l;i=1<=l?++f:--f){a=e["TFORM"+i],o=a.match(t.arrayDescriptorPattern),u=e["TTYPE"+i].toUpperCase(),this.columnNames[u]=i-1,n=null;if(o!=null){r=o[1];switch(u){case"COMPRESSED_DATA":(function(e){return n=function(){var n,r;return n=p._accessor(e),n==null?new Float32Array(p.ztile[0]):(r=new t.typedArray[p.algorithmParameters.BYTEPIX](p.ztile[0]),t.Rice(n,s,p.algorithmParameters.BLOCKSIZE,p.algorithmParameters.BYTEPIX,r,p.ztile[0]),r)}})(r);break;case"UNCOMPRESSED_DATA":(function(e){return n=p._accessor(e)})(r);break;case"GZIP_COMPRESSED_DATA":(function(e){return n=function(){var t,n,r,i,s;t=p._accessor(e);if(t!=null){t=new Float32Array(p.width);for(n=i=0,s=t.length;i<s;n=++i)r=t[n],t[n]=NaN;return t}return null}})(r);break;default:(function(e){return n=p._accessor(e)})(r)}}else o=a.match(t.dataTypePattern),c=o.slice(1),s=c[0],r=c[1],s=s!=null?parseInt(s):0,s===0||s===1?function(e){return n=function(){return t.dataAccessors[e](p.view)}}(r):function(e,r){return n=function(){var n,s,o;n=new t.typedArray[r](e);for(i=s=0,o=e-1;0<=o?s<=o:s>=o;i=0<=o?++s:--s)n[i]=t.dataAccessors[r](p.view);return n}}(s,r);h.push(this.accessors.push(n))}return h},t.prototype.defineGetRow=function(){var e;return this.totalRowsRead=0,e=this.zblank!=null||this.blank!=null||this.columnNames.hasOwnProperty("ZBLANK"),this.getRow=e?this.getRowHasBlanks:this.getRowNoBlanks},t.prototype.setRiceDefaults=function(){this.algorithmParameters.hasOwnProperty("BLOCKSIZE")||(this.algorithmParameters.BLOCKSIZE=32);if(!this.algorithmParameters.hasOwnProperty("BYTEPIX"))return this.algorithmParameters.BYTEPIX=4},t.setValue=function(e,t,n){return e.contains(t)?e[t]:n},t.prototype.getRowHasBlanks=function(){var e,t,n,r,i,s,o,u,a,f;f=this._getRow(),t=f[0],e=f[1],i=f[2],o=f[3];for(n=u=0,a=t.length;u<a;n=++u)s=t[n],r=this.totalRowsRead*this.width+n,this.data[r]=s===e?NaN:o+i*s;return this.rowsRead+=1,this.totalRowsRead+=1},t.prototype.getRowNoBlanks=function(){var e,t,n,r,i,s,o,u,a,f;f=this._getRow(),t=f[0],e=f[1],i=f[2],o=f[3];for(n=u=0,a=t.length;u<a;n=++u)s=t[n],r=this.totalRowsRead*this.width+n,this.data[r]=o+i*s;return this.rowsRead+=1,this.totalRowsRead+=1},t.prototype.getFrame=function(){var e;this.data==null&&this.initArray(Float32Array),this.totalRowsRead=0,this.rowsRead=0,e=this.height;while(e--)this.getRow();return this.data},t.prototype._accessor=function(e){var n,r,i,s,o,u,a;u=[this.view.getInt32(),this.view.getInt32()],i=u[0],s=u[1];if(i===0)return null;n=new t.typedArray[e](i),this.current=this.view.tell(),this.view.seek(this.begin+this.tableLength+s);for(r=o=0,a=i-1;0<=a?o<=a:o>=a;r=0<=a?++o:--o)n[r]=t.dataAccessors[e](this.view);return this.view.seek(this.current),n},t.prototype._getRow=function(){var e,t,n,r,i,s,o,u,a;this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),r=[],a=this.accessors;for(o=0,u=a.length;o<u;o++)e=a[o],r.push(e());return n=r[this.columnNames.COMPRESSED_DATA]||r[this.columnNames.UNCOMPRESSED_DATA]||r[this.columnNames.GZIP_COMPRESSED_DATA],t=r[this.columnNames.ZBLANK]||this.zblank,i=r[this.columnNames.ZSCALE]||this.bscale,s=r[this.columnNames.ZZERO]||this.bzero,[n,t,i,s]},t.subtractiveDither1=function(){throw"Not yet implemented"},t.linearScaling=function(){throw"Not yet implemented"},t}(h),this.astro.fits.CompressedImage=t,s=function(){function e(e,t){this.header=e,this.data=t}return e.prototype.hasData=function(){return this.data!=null?!0:!1},e.prototype.getCard=function(e){return this.header[e]},e}(),this.astro.fits.HDU=s,i=function(){function n(e){var t;t=n.getType(e);switch(t){case"arraybuffer":this.initFromBuffer(e);break;case"object":this.initFromObject(e);break;default:throw"fitsjs cannot initialize object"}}return n.LINEWIDTH=80,n.BLOCKLENGTH=2880,n.getType=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},n.excessBytes=function(e){return(n.BLOCKLENGTH-e%n.BLOCKLENGTH)%n.BLOCKLENGTH},n.extendDataView=function(e){var t,n,r,i,s,o,u,a;return DataView.prototype.getString=function(e){var t,n,r,i,s;r="";for(n=i=0,s=e-1;0<=s?i<=s:i>=s;n=0<=s?++i:--i)t=this.getUint8(),r+=String.fromCharCode(t>127?65533:t);return r},DataView.prototype.getChar=function(){return this.getString(1)},e.offset=0,s=e.getInt8,a=e.getUint8,r=e.getInt16,o=e.getUint16,i=e.getInt32,u=e.getUint32,t=e.getFloat32,n=e.getFloat64,e.getInt8=function(){var e;return e=s.apply(this,[this.offset]),this.offset+=1,e},e.getUint8=function(){var e;return e=a.apply(this,[this.offset]),this.offset+=1,e},e.getInt16=function(){var e;return e=r.apply(this,[this.offset,!1]),this.offset+=2,e},e.getUint16=function(){var e;return e=o.apply(this,[this.offset,!1]),this.offset+=2,e},e.getInt32=function(){var e;return e=i.apply(this,[this.offset,!1]),this.offset+=4,e},e.getUint32=function(){var e;return e=u.apply(this,[this.offset,!1]),this.offset+=4,e},e.getFloat32=function(){var e;return e=t.apply(this,[this.offset,!1]),this.offset+=4,e},e.getFloat64=function(){var e;return e=n.apply(this,[this.offset,!1]),this.offset+=8,e},e.seek=function(e){return this.offset=e},e.tell=function(){return this.offset}},n.prototype.initFromBuffer=function(e){var t,r,i,o;this.length=e.byteLength,this.view=new DataView(e),this.hdus=[],this.eof=!1,n.extendDataView(this.view),o=[];for(;;){i=this.readHeader(),t=this.readData(i),r=new s(i,t),this.hdus.push(r);if(this.eof)break;o.push(void 0)}return o},n.prototype.initFromObject=function(e){return this.length=e.length,this.view=null,this.hdus=e.hdus,this.eof=!0},n.prototype.readHeader=function(){var e,t,r,i,s,u,a,f,l,c,h,p;p=/\s{80}/,u=/^END\s/,e=this.view.tell(),r=!1;for(;;){if(r)break;t=this.view.getString(n.BLOCKLENGTH),f=0;for(;;){h=n.BLOCKLENGTH-n.LINEWIDTH*(f+1),i=n.BLOCKLENGTH-n.LINEWIDTH*f,l=t.slice(h,i),c=l.match(p);if(c){f+=1;continue}c=l.match(u);if(c)return s=this.view.tell(),this.view.seek(e),t=this.view.getString(s-e),a=new o,a.init(t),r=!0,this.checkEOF(),a;break}}},n.prototype.readData=function(r){var i,s;if(!r.hasDataUnit())return;return r.isPrimary()?i=new a(this.view,r):r.isExtension()&&(r.extensionType==="BINTABLE"?r.contains("ZIMAGE")?i=new t(this.view,r):i=new e(this.view,r):r.extensionType==="TABLE"?i=new c(this.view,r):r.extensionType==="IMAGE"&&(i=new a(this.view,r))),s=n.excessBytes(i.length),this.view.seek(this.view.tell()+i.length+s),this.checkEOF(),i},n.prototype.checkEOF=function(){if(this.view.offset>=this.length)return this.eof=!0},n.prototype.count=function(){return this.hdus.length},n.prototype.getHDU=function(e){var t,n,r,i;e==null&&(e=void 0);if(e!=null&&this.hdus[e]!=null)return this.hdus[e];i=this.hdus;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.hasData())return t}},n.prototype.getHeader=function(e){return e==null&&(e=void 0),this.getHDU(e).header},n.prototype.getDataUnit=function(e){return e==null&&(e=void 0),this.getHDU(e).data},n.prototype.getData=function(e){return e==null&&(e=void 0),this.getHDU(e).data.getFrame()},n}(),this.astro.fits.File=i}).call(this);