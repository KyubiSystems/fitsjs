<!DOCTYPE html><html lang="en"><head><title>src/header.verify</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/header.verify"><meta name="groc-project-path" content="src/header.verify.coffee"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/header.verify.coffee</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><p>This module is a collection of function for verifying reserved keywords of the FITS standard
When new keywords and extensions are defined, this module may be extended.</p></div></div><div class="code"><div class="wrapper"><span class="nv">HeaderVerify =</span>
  
  <span class="nv">verifyOrder: </span><span class="nf">(keyword, order) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">keyword</span><span class="si">}</span><span class="s"> should appear at index </span><span class="si">#{</span><span class="nx">@cardIndex</span><span class="si">}</span><span class="s"> in the FITS header&quot;</span><span class="p">)</span> <span class="k">unless</span> <span class="nx">order</span> <span class="o">is</span> <span class="nx">@cardIndex</span>

  <span class="nv">verifyBetween: </span><span class="nf">(keyword, value, lower, upper) -&gt;</span>
    <span class="k">throw</span> <span class="s">&quot;The </span><span class="si">#{</span><span class="nx">keyword</span><span class="si">}</span><span class="s"> value of </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s"> is not between </span><span class="si">#{</span><span class="nx">lower</span><span class="si">}</span><span class="s"> and </span><span class="si">#{</span><span class="nx">upper</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">lower</span> <span class="o">and</span> <span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">upper</span>

  <span class="nv">verifyBoolean: </span><span class="nf">(value) -&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="s">&quot;T&quot;</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span>

  <span class="nv">VerifyFns:</span>
    <span class="nv">SIMPLE: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="vi">@primary = </span><span class="kc">true</span>
      <span class="nx">@verifyOrder</span><span class="p">(</span><span class="s">&quot;SIMPLE&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">@verifyBoolean</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
      
    <span class="nv">XTENSION: </span><span class="nf">(args...) -&gt;</span>
      <span class="vi">@extension = </span><span class="kc">true</span>
      <span class="vi">@extensionType = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@verifyOrder</span><span class="p">(</span><span class="s">&quot;XTENSION&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">@extensionType</span>
      
    <span class="nv">BITPIX: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">key = </span><span class="s">&quot;BITPIX&quot;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nx">@verifyOrder</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">throw</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s"> value </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s"> is not permitted&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="k">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">64</span><span class="p">]</span>
      <span class="k">return</span> <span class="nx">value</span>
      
    <span class="nv">NAXIS: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">key = </span><span class="s">&quot;NAXIS&quot;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nv">array = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      
      <span class="k">unless</span> <span class="nx">array</span>
        <span class="nx">@verifyOrder</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nx">@verifyBetween</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">@isExtension</span><span class="p">()</span>
          <span class="k">if</span> <span class="nx">@extensionType</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;TABLE&quot;</span><span class="p">,</span> <span class="s">&quot;BINTABLE&quot;</span><span class="p">]</span>
            <span class="nv">required = </span><span class="mi">2</span>
            <span class="k">throw</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s"> must be </span><span class="si">#{</span><span class="nx">required</span><span class="si">}</span><span class="s"> for TABLE and BINTABLE extensions&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">required</span>
      
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">PCOUNT: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">key = </span><span class="s">&quot;PCOUNT&quot;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nv">order = </span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&quot;NAXIS&quot;</span><span class="p">)</span>
      <span class="nx">@verifyOrder</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="nx">@isExtension</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">@extensionType</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="s">&quot;TABLE&quot;</span><span class="p">]</span>
          <span class="nv">required = </span><span class="mi">0</span>
          <span class="k">throw</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s"> must be </span><span class="si">#{</span><span class="nx">required</span><span class="si">}</span><span class="s"> for the </span><span class="si">#{</span><span class="nx">@extensionType</span><span class="si">}</span><span class="s"> extensions&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">required</span>
      
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">GCOUNT: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">key = </span><span class="s">&quot;GCOUNT&quot;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nv">order = </span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&quot;NAXIS&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="nx">@verifyOrder</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="nx">@isExtension</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">@extensionType</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="s">&quot;TABLE&quot;</span><span class="p">,</span> <span class="s">&quot;BINTABLE&quot;</span><span class="p">]</span>
          <span class="nv">required = </span><span class="mi">1</span>
          <span class="k">throw</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s"> must be </span><span class="si">#{</span><span class="nx">required</span><span class="si">}</span><span class="s"> for the </span><span class="si">#{</span><span class="nx">@extensionType</span><span class="si">}</span><span class="s"> extensions&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">required</span>
      
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">EXTEND: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">throw</span> <span class="s">&quot;EXTEND must only appear in the primary header&quot;</span> <span class="k">unless</span> <span class="nx">@isPrimary</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">@verifyBoolean</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    
    <span class="nv">BSCALE: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">BZERO: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      
    <span class="nv">BLANK: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">throw</span> <span class="s">&quot;BLANK is not to be used for BITPIX = </span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;BITPIX&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">unless</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&quot;BIXPIX&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    
    <span class="nv">DATAMIN: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">DATAMAX: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">EXTVER: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      
    <span class="nv">EXTLEVEL: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">TFIELDS: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nx">@verifyBetween</span><span class="p">(</span><span class="s">&quot;TFIELDS&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">TBCOL: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">index = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="nx">@verifyBetween</span><span class="p">(</span><span class="s">&quot;TBCOL&quot;</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&quot;TFIELDS&quot;</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">ZIMAGE: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nx">@verifyBoolean</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">ZCMPTYPE: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">throw</span> <span class="s">&quot;ZCMPTYPE value </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s"> is not permitted&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;GZIP_1&#39;</span><span class="p">,</span> <span class="s">&#39;RICE_1&#39;</span><span class="p">,</span> <span class="s">&#39;PLIO_1&#39;</span><span class="p">,</span> <span class="s">&#39;HCOMPRESS_1&#39;</span><span class="p">]</span>
      <span class="k">throw</span> <span class="s">&quot;Compress type </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s"> is not yet implement&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;RICE_1&#39;</span><span class="p">]</span>
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">ZBITPIX: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="k">throw</span> <span class="s">&quot;ZBITPIX value </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s"> is not permitted&quot;</span> <span class="k">unless</span> <span class="nx">value</span> <span class="k">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">64</span><span class="p">]</span>
      <span class="k">return</span> <span class="nx">value</span>
      
    <span class="nv">ZNAXIS: </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">value = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nv">array = </span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">value = </span><span class="nx">value</span>
      
      <span class="nx">@verifyBetween</span><span class="p">(</span><span class="s">&quot;ZNAXIS&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span> <span class="k">unless</span> <span class="nx">array</span>
      
      <span class="k">return</span> <span class="nx">value</span>
    
    <span class="nv">ZTILE: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">ZSIMPLE: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="k">if</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;T&quot;</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span>
    
    <span class="nv">ZPCOUNT: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">ZGCOUNT: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="nv">ZDITHER0: </span><span class="nf">(args...) -&gt;</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


<span class="vi">@astro.FITS.HeaderVerify = </span><span class="nx">HeaderVerify</span></div></div></div></div></body></html>