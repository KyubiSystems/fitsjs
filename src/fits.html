<!DOCTYPE html><html lang="en"><head><title>src/fits</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/fits"><meta name="groc-project-path" content="src/fits.coffee"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/fits.coffee</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="vi">@astro = </span><span class="p">{}</span> <span class="k">unless</span> <span class="nx">@astro</span><span class="o">?</span>


<span class="k">class</span> <span class="nx">Base</span>
  <span class="vi">@include: </span><span class="nf">(obj) -&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">obj</span>
      <span class="nx">@</span><span class="o">::</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="k">this</span>

  <span class="vi">@extend: </span><span class="nf">(obj) -&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">obj</span>
      <span class="nx">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="k">this</span>

  <span class="nv">proxy: </span><span class="nf">(func) -&gt;</span>
    <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
  
  <span class="nv">invoke: </span><span class="nf">(callback, opts, data) -&gt;</span>
    <span class="nv">context = </span><span class="k">if</span> <span class="nx">opts</span><span class="o">?</span><span class="p">.</span><span class="nx">context</span><span class="o">?</span> <span class="k">then</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">context</span> <span class="k">else</span> <span class="nx">@</span>
    <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="k">if</span> <span class="nx">callback</span><span class="o">?</span>


<span class="k">class</span> <span class="nx">Parser</span> <span class="k">extends</span> <span class="nx">Base</span>
  <span class="nv">LINEWIDTH: </span><span class="mi">80</span>
  <span class="nv">BLOCKLENGTH: </span><span class="mi">2880</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>FITS objects are constructed using either
1) Path to a remote FITS file
2) Native File object</p></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>First argument is either a path or File object
Second argument is a callback to execute after
initialization is complete
Third argument is a set of options that may be passed
to the callback.  If opts has the context key, the callback
is executed with respect to that context.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">constructor: </span><span class="nf">(@arg, @callback, @opts) -&gt;</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Storage for header dataunits</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@hdus = </span><span class="p">[]</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Set initial state for parsing buffer
Blocks of 2880 will be read until an entire header is read.
The process will be repeated until all headers have been parsed from file.</p></div></div><div class="code"><div class="wrapper">    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Number of 2880 blocks read.  This is reset every time an entire header is extracted.</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@blockCount = </span><span class="mi">0</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Byte offsets relative to the current header</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@begin = </span><span class="mi">0</span>
    <span class="vi">@end = </span><span class="nx">@BLOCKLENGTH</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Byte offset relative to the file</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@offset = </span><span class="mi">0</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Initial storage for storing header while parsing.</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@headerStorage = </span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">()</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check the input type for either
1) Path to remote file
2) Native File object</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">@arg</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Define function at runtime for getting next block</p></div></div><div class="code"><div class="wrapper">      <span class="vi">@readNextBlock = </span><span class="nx">@_readBlockFromBuffer</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get the remote file as an arraybuffer</p></div></div><div class="code"><div class="wrapper">      <span class="nv">xhr = </span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">@arg</span><span class="p">)</span>
      <span class="nv">xhr.responseType = </span><span class="s">&#39;arraybuffer&#39;</span>
      <span class="nv">xhr.onload = </span><span class="o">=&gt;</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Error handling on the response status</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">isnt</span> <span class="mi">200</span>
          </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Execute callback returning a null object on failure</p></div></div><div class="code"><div class="wrapper">          <span class="nx">@invoke</span><span class="p">(</span><span class="nx">@callback</span><span class="p">,</span> <span class="nx">@opts</span><span class="p">)</span>
          <span class="k">return</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get buffer from response</p></div></div><div class="code"><div class="wrapper">        <span class="vi">@arg = </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Store the buffer byte length</p></div></div><div class="code"><div class="wrapper">        <span class="vi">@length = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">byteLength</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Begin reading buffer</p></div></div><div class="code"><div class="wrapper">        <span class="nx">@readFromBuffer</span><span class="p">()</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Send the request</p></div></div><div class="code"><div class="wrapper">      <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
      
    <span class="k">else</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Store the file byte length</p></div></div><div class="code"><div class="wrapper">      <span class="vi">@length = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">size</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Define function at runtime for getting next block</p></div></div><div class="code"><div class="wrapper">      <span class="vi">@readNextBlock = </span><span class="nx">@_readBlockFromFile</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get the local file as an arraybuffer</p></div></div><div class="code"><div class="wrapper">      <span class="nx">@readFromFile</span><span class="p">()</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Interpret an array buffer that is already copied in memory.  Usually
used for remote files, though this can be used for local files if
the arraybuffer is already in memory.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">readFromBuffer: </span><span class="nf">-&gt;</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get first 2880 block</p></div></div><div class="code"><div class="wrapper">    <span class="nv">block = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@begin</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">,</span> <span class="nx">@end</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Begin parsing for headers</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@readBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Read a file by copying only the headers into memory.  This is needed
to handle large files efficiently.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">readFromFile: </span><span class="nf">-&gt;</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Initialize a new FileReader</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@reader = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Set reader handler</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@reader.onloadend = </span><span class="nf">(e) =&gt;</span>
      <span class="nx">@readBlock</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get first 2880 block</p></div></div><div class="code"><div class="wrapper">    <span class="nv">block = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@begin</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">,</span> <span class="nx">@end</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Begin parsing for headers</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@reader</span><span class="p">.</span><span class="nx">readAsArrayBuffer</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Read a 2880 size block. Function is responsible for storing block,
searching for END marker, initializing an HDU, and clearing storage.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">readBlock: </span><span class="nf">(block) -&gt;</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Read block as integers</p></div></div><div class="code"><div class="wrapper">    <span class="nv">arr = </span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Temporary storage for header</p></div></div><div class="code"><div class="wrapper">    <span class="nv">tmp = </span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">@headerStorage</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Reallocate header storage</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@headerStorage = </span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">@end</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Copy contents from temporary storage</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@headerStorage</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Copy contents from current iteration</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@headerStorage</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">@begin</span><span class="p">)</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check current array one row at a time starting from
bottom of the block.</p></div></div><div class="code"><div class="wrapper">    <span class="nv">rows = </span><span class="nx">@BLOCKLENGTH</span> <span class="o">/</span> <span class="nx">@LINEWIDTH</span>
    <span class="k">while</span> <span class="nx">rows</span><span class="o">--</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get index of first element in row</p></div></div><div class="code"><div class="wrapper">      <span class="nv">rowIndex = </span><span class="nx">rows</span> <span class="o">*</span> <span class="nx">@LINEWIDTH</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Go to next row if whitespace found</p></div></div><div class="code"><div class="wrapper">      <span class="k">continue</span> <span class="k">if</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">is</span> <span class="mi">32</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check for END keyword with trailing space (69, 78, 68, 32)</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">rowIndex</span><span class="p">]</span> <span class="o">is</span> <span class="mi">69</span> <span class="o">and</span>
         <span class="nx">arr</span><span class="p">[</span><span class="nx">rowIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">is</span> <span class="mi">78</span> <span class="o">and</span>
         <span class="nx">arr</span><span class="p">[</span><span class="nx">rowIndex</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">is</span> <span class="mi">68</span> <span class="o">and</span>
         <span class="nx">arr</span><span class="p">[</span><span class="nx">rowIndex</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">is</span> <span class="mi">32</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Interpret as string</p></div></div><div class="code"><div class="wrapper">        <span class="nv">s = </span><span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">@headerStorage</span>
          <span class="nx">s</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
        <span class="nv">header = </span><span class="k">new</span> <span class="nx">Header</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get data unit start and length</p></div></div><div class="code"><div class="wrapper">        <span class="vi">@start = </span><span class="nx">@end</span> <span class="o">+</span> <span class="nx">@offset</span>
        <span class="nv">dataLength = </span><span class="nx">header</span><span class="p">.</span><span class="nx">getDataLength</span><span class="p">()</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create data unit instance</p></div></div><div class="code"><div class="wrapper">        <span class="nv">slice = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@start</span><span class="p">,</span> <span class="nx">@start</span> <span class="o">+</span> <span class="nx">dataLength</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">header</span><span class="p">.</span><span class="nx">hasDataUnit</span><span class="p">()</span>
          <span class="nv">dataunit = </span><span class="nx">@createDataUnit</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="nx">slice</span><span class="p">)</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Store HDU on instance</p></div></div><div class="code"><div class="wrapper">        <span class="nx">@hdus</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="k">new</span> <span class="nx">HDU</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="nx">dataunit</span><span class="p">)</span> <span class="p">)</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Update byte offset</p></div></div><div class="code"><div class="wrapper">        <span class="nx">@offset</span> <span class="o">+=</span> <span class="nx">@end</span> <span class="o">+</span> <span class="nx">dataLength</span> <span class="o">+</span> <span class="nx">@excessBytes</span><span class="p">(</span><span class="nx">dataLength</span><span class="p">)</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Return if at the end of file</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="nx">@offset</span> <span class="o">is</span> <span class="nx">@length</span>
          <span class="vi">@headerStorage = </span><span class="kc">null</span>
          
          <span class="nx">@invoke</span><span class="p">(</span><span class="nx">@callback</span><span class="p">,</span> <span class="nx">@opts</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
          <span class="k">return</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Reset variables for next header</p></div></div><div class="code"><div class="wrapper">        <span class="vi">@blockCount = </span><span class="mi">0</span>
        <span class="vi">@begin = </span><span class="nx">@blockCount</span> <span class="o">*</span> <span class="nx">@BLOCKLENGTH</span>
        <span class="vi">@end = </span><span class="nx">@begin</span> <span class="o">+</span> <span class="nx">@BLOCKLENGTH</span>
        <span class="vi">@headerStorage = </span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">()</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get next block</p></div></div><div class="code"><div class="wrapper">        <span class="nv">block = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@begin</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">,</span> <span class="nx">@end</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">)</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Begin parsing for next header</p></div></div><div class="code"><div class="wrapper">        <span class="nx">@readNextBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
        <span class="k">return</span>
      
      <span class="k">break</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Read next block since END not found</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@blockCount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="vi">@begin = </span><span class="nx">@blockCount</span> <span class="o">*</span> <span class="nx">@BLOCKLENGTH</span>
    <span class="vi">@end = </span><span class="nx">@begin</span> <span class="o">+</span> <span class="nx">@BLOCKLENGTH</span>
    <span class="nv">block = </span><span class="nx">@arg</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@begin</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">,</span> <span class="nx">@end</span> <span class="o">+</span> <span class="nx">@offset</span><span class="p">)</span>
    <span class="nx">@readNextBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
    <span class="k">return</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Use one of these depending on the initialization parameter (File or ArrayBuffer)</p></div></div><div class="code"><div class="wrapper">  <span class="nv">_readBlockFromBuffer: </span><span class="nf">(block) -&gt;</span> <span class="nx">@readBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
  <span class="nv">_readBlockFromFile: </span><span class="nf">(block) -&gt;</span> <span class="nx">@reader</span><span class="p">.</span><span class="nx">readAsArrayBuffer</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create the appropriate data unit based on info from header</p></div></div><div class="code"><div class="wrapper">  <span class="nv">createDataUnit: </span><span class="nf">(header, blob) -&gt;</span>
    <span class="nv">type = </span><span class="nx">header</span><span class="p">.</span><span class="nx">getDataType</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">astro</span><span class="p">.</span><span class="nx">FITS</span><span class="p">[</span><span class="nx">type</span><span class="p">](</span><span class="nx">header</span><span class="p">,</span> <span class="nx">blob</span><span class="p">)</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Determine the number of characters following a header or data unit</p></div></div><div class="code"><div class="wrapper">  <span class="nv">excessBytes: </span><span class="nf">(length) -&gt;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">@BLOCKLENGTH</span> <span class="o">-</span> <span class="p">(</span><span class="nx">length</span> <span class="o">%</span> <span class="nx">@BLOCKLENGTH</span><span class="p">))</span> <span class="o">%</span> <span class="nx">@BLOCKLENGTH</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check for the end of file</p></div></div><div class="code"><div class="wrapper">  <span class="nv">isEOF: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">@offset</span> <span class="o">is</span> <span class="nx">@length</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span>
  
  
<span class="k">class</span> <span class="nx">FITS</span> <span class="k">extends</span> <span class="nx">Base</span>
  
  <span class="nv">constructor: </span><span class="nf">(@arg, callback, opts) -&gt;</span>
    
    <span class="nv">parser = </span><span class="k">new</span> <span class="nx">Parser</span><span class="p">(</span><span class="nx">@arg</span><span class="p">,</span> <span class="nf">(fits) =&gt;</span>
      <span class="vi">@hdus = </span><span class="nx">parser</span><span class="p">.</span><span class="nx">hdus</span>
      <span class="nx">@invoke</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
    <span class="p">)</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Public API</p></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Returns the first HDU containing a data unit.  An optional argument may be passed to retreive 
a specific HDU</p></div></div><div class="code"><div class="wrapper">  <span class="nv">getHDU: </span><span class="nf">(index) -&gt;</span>
    <span class="k">return</span> <span class="nx">@hdus</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="k">if</span> <span class="nx">index</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@hdus</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span><span class="o">?</span>
    <span class="k">for</span> <span class="nx">hdu</span> <span class="k">in</span> <span class="nx">@hdus</span>
      <span class="k">return</span> <span class="nx">hdu</span> <span class="k">if</span> <span class="nx">hdu</span><span class="p">.</span><span class="nx">hasData</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Returns the header associated with the first HDU containing a data unit.  An optional argument
may be passed to point to a specific HDU.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">getHeader: </span><span class="nf">(index) -&gt;</span> <span class="k">return</span> <span class="nx">@getHDU</span><span class="p">(</span><span class="nx">index</span><span class="p">).</span><span class="nx">header</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Returns the data object associated with the first HDU containing a data unit.  This method does not read from the array buffer
An optional argument may be passed to point to a specific HDU.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">getDataUnit: </span><span class="nf">(index) -&gt;</span> <span class="k">return</span> <span class="nx">@getHDU</span><span class="p">(</span><span class="nx">index</span><span class="p">).</span><span class="nx">data</span>


<span class="nv">FITS.version = </span><span class="s">&#39;0.5.0&#39;</span>
<span class="vi">@astro.FITS = </span><span class="nx">FITS</span></div></div></div></div></body></html>