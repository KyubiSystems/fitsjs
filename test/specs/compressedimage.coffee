# window.FITS = astro.FITS
# 
# describe "FITS CompressedImage", ->
# 
#   it 'can read a FITS compressed image', ->
#     precision = 6
#     fits = null
#     
#     xhr = new XMLHttpRequest()
#     xhr.open('GET', 'data/CFHTLS_03_g_sci.fits.fz')
#     xhr.responseType = 'arraybuffer'
#     xhr.onload = -> fits = new FITS.File(xhr.response)
#     xhr.send()
#     
#     waitsFor -> return fits?
#     
#     runs ->
#       
#       image = fits.getDataUnit()
#       arr = image.getFrame()
#       image.getExtent(arr)
#       
#       expect(image.min).toBeCloseTo(-2.981497, precision)
#       expect(image.max).toBeCloseTo(1273.853638, precision)
#       
#       expect(image.getPixel(arr, 0, 0)).toBeCloseTo(0.173962, precision)
#       expect(image.getPixel(arr, 400, 0)).toBeCloseTo(0.347923, precision)
#       expect(image.getPixel(arr, 400, 400)).toBeCloseTo(0.344889, precision)
#       expect(image.getPixel(arr, 0, 400)).toBeCloseTo(1.20711267, precision)
#       
#       # ... and a few other random pixels
#       expect(image.getPixel(arr, 33, 205)).toBeCloseTo(0.975486, precision)
#       expect(image.getPixel(arr, 44, 149)).toBeCloseTo(-0.774174, precision)
#       expect(image.getPixel(arr, 237, 377)).toBeCloseTo(-0.668716, precision)
#       expect(image.getPixel(arr, 393, 27)).toBeCloseTo(0.490127, precision)
#   
#   it 'can read a frame by spawning a web worker', ->
#     precision = 6
#     fits = arr = null
#     ready = false
#     
#     path = 'data/CFHTLS_03_g_sci.fits.fz'
#     fits = new FITS.File(path, (f) ->
#       dataunit = f.getDataUnit()
#       
#       dataunit.getFrameAsync(0, (array) ->
#         ready = true
#         arr = array
#       )
#     )
#     waitsFor -> return ready
# 
#     runs ->
#       image = fits.getDataUnit()
#       image.getExtent(arr)
#       
#       expect(image.min).toBeCloseTo(-2.981497, precision)
#       expect(image.max).toBeCloseTo(1273.853638, precision)
#       
#       expect(image.getPixel(arr, 0, 0)).toBeCloseTo(0.173962, precision)
#       expect(image.getPixel(arr, 400, 0)).toBeCloseTo(0.347923, precision)
#       expect(image.getPixel(arr, 400, 400)).toBeCloseTo(0.344889, precision)
#       expect(image.getPixel(arr, 0, 400)).toBeCloseTo(1.20711267, precision)
#       
#       # ... and a few other random pixels
#       expect(image.getPixel(arr, 33, 205)).toBeCloseTo(0.975486, precision)
#       expect(image.getPixel(arr, 44, 149)).toBeCloseTo(-0.774174, precision)
#       expect(image.getPixel(arr, 237, 377)).toBeCloseTo(-0.668716, precision)
#       expect(image.getPixel(arr, 393, 27)).toBeCloseTo(0.490127, precision)
#   
#   it 'can apply subtractive dithering on a compressed FITS image', ->
#     # Actually turns out subtractive dithering is not used on this file ...
#     precision = 6
#     fits = null
#     
#     xhr = new XMLHttpRequest()
#     xhr.open('GET', 'data/CFHTLS_02_i_sci.fits.fz')
#     xhr.responseType = 'arraybuffer'
#     xhr.onload = ->
#       fits = new FITS.File(xhr.response)
#     xhr.send()
#     
#     waitsFor -> return fits?
#     
#     runs ->
#       image = fits.getDataUnit()
#       arr = image.getFrame()
#       
#       expect(image.getPixel(arr, 0, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 1, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 2, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 3, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 4, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 5, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 6, 0)).toBeCloseTo(-4.440351, precision)
#       expect(image.getPixel(arr, 7, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 8, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 9, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 10, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 11, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 12, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 13, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 14, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 15, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 16, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 17, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 18, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 19, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 20, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 21, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 22, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 23, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 24, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 25, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 26, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 27, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 28, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 29, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 30, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 31, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 32, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 33, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 34, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 35, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 36, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 37, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 38, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 39, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 40, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 41, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 42, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 43, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 44, 0)).toBeCloseTo(-4.440351, precision)
#       expect(image.getPixel(arr, 45, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 46, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 47, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 48, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 49, 0)).toBeCloseTo(4.036683, precision)
#       expect(image.getPixel(arr, 50, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 51, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 52, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 53, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 54, 0)).toBeCloseTo(-3.229346, precision)
#       expect(image.getPixel(arr, 55, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 56, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 57, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 58, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 59, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 60, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 61, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 62, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 63, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 64, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 65, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 66, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 67, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 68, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 69, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 70, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 71, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 72, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 73, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 74, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 75, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 76, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 77, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 78, 0)).toBeCloseTo(-4.036683, precision)
#       expect(image.getPixel(arr, 79, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 80, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 81, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 82, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 83, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 84, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 85, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 86, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 87, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 88, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 89, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 90, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 91, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 92, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 93, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 94, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 95, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 96, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 97, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 98, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 99, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 100, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 101, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 102, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 103, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 104, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 105, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 106, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 107, 0)).toBeCloseTo(6.458693, precision)
#       expect(image.getPixel(arr, 108, 0)).toBeCloseTo(8.477034, precision)
#       expect(image.getPixel(arr, 109, 0)).toBeCloseTo(6.055024, precision)
#       expect(image.getPixel(arr, 110, 0)).toBeCloseTo(3.229346, precision)
#       expect(image.getPixel(arr, 111, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 112, 0)).toBeCloseTo(4.844019, precision)
#       expect(image.getPixel(arr, 113, 0)).toBeCloseTo(4.036683, precision)
#       expect(image.getPixel(arr, 114, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 115, 0)).toBeCloseTo(3.633014, precision)
#       expect(image.getPixel(arr, 116, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 117, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 118, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 119, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 120, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 121, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 122, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 123, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 124, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 125, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 126, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 127, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 128, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 129, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 130, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 131, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 132, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 133, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 134, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 135, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 136, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 137, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 138, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 139, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 140, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 141, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 142, 0)).toBeCloseTo(-4.440351, precision)
#       expect(image.getPixel(arr, 143, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 144, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 145, 0)).toBeCloseTo(-4.036683, precision)
#       expect(image.getPixel(arr, 146, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 147, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 148, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 149, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 150, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 151, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 152, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 153, 0)).toBeCloseTo(3.229346, precision)
#       expect(image.getPixel(arr, 154, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 155, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 156, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 157, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 158, 0)).toBeCloseTo(-3.633014, precision)
#       expect(image.getPixel(arr, 159, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 160, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 161, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 162, 0)).toBeCloseTo(3.229346, precision)
#       expect(image.getPixel(arr, 163, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 164, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 165, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 166, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 167, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 168, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 169, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 170, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 171, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 172, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 173, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 174, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 175, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 176, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 177, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 178, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 179, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 180, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 181, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 182, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 183, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 184, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 185, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 186, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 187, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 188, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 189, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 190, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 191, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 192, 0)).toBeCloseTo(6.458693, precision)
#       expect(image.getPixel(arr, 193, 0)).toBeCloseTo(6.055024, precision)
#       expect(image.getPixel(arr, 194, 0)).toBeCloseTo(5.247688, precision)
#       expect(image.getPixel(arr, 195, 0)).toBeCloseTo(5.651356, precision)
#       expect(image.getPixel(arr, 196, 0)).toBeCloseTo(7.266029, precision)
#       expect(image.getPixel(arr, 197, 0)).toBeCloseTo(10.091707, precision)
#       expect(image.getPixel(arr, 198, 0)).toBeCloseTo(9.284370, precision)
#       expect(image.getPixel(arr, 199, 0)).toBeCloseTo(4.036683, precision)
#       expect(image.getPixel(arr, 200, 0)).toBeCloseTo(4.440351, precision)
#       expect(image.getPixel(arr, 201, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 202, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 203, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 204, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 205, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 206, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 207, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 208, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 209, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 210, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 211, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 212, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 213, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 214, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 215, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 216, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 217, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 218, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 219, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 220, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 221, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 222, 0)).toBeCloseTo(-3.633014, precision)
#       expect(image.getPixel(arr, 223, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 224, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 225, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 226, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 227, 0)).toBeCloseTo(4.036683, precision)
#       expect(image.getPixel(arr, 228, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 229, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 230, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 231, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 232, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 233, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 234, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 235, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 236, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 237, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 238, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 239, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 240, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 241, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 242, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 243, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 244, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 245, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 246, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 247, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 248, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 249, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 250, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 251, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 252, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 253, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 254, 0)).toBeCloseTo(3.229346, precision)
#       expect(image.getPixel(arr, 255, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 256, 0)).toBeCloseTo(3.229346, precision)
#       expect(image.getPixel(arr, 257, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 258, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 259, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 260, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 261, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 262, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 263, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 264, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 265, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 266, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 267, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 268, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 269, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 270, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 271, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 272, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 273, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 274, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 275, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 276, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 277, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 278, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 279, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 280, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 281, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 282, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 283, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 284, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 285, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 286, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 287, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 288, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 289, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 290, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 291, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 292, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 293, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 294, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 295, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 296, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 297, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 298, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 299, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 300, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 301, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 302, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 303, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 304, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 305, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 306, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 307, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 308, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 309, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 310, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 311, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 312, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 313, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 314, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 315, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 316, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 317, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 318, 0)).toBeCloseTo(-4.440351, precision)
#       expect(image.getPixel(arr, 319, 0)).toBeCloseTo(-3.229346, precision)
#       expect(image.getPixel(arr, 320, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 321, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 322, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 323, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 324, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 325, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 326, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 327, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 328, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 329, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 330, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 331, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 332, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 333, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 334, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 335, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 336, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 337, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 338, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 339, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 340, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 341, 0)).toBeCloseTo(-3.229346, precision)
#       expect(image.getPixel(arr, 342, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 343, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 344, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 345, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 346, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 347, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 348, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 349, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 350, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 351, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 352, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 353, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 354, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 355, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 356, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 357, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 358, 0)).toBeCloseTo(5.247688, precision)
#       expect(image.getPixel(arr, 359, 0)).toBeCloseTo(7.266029, precision)
#       expect(image.getPixel(arr, 360, 0)).toBeCloseTo(3.633014, precision)
#       expect(image.getPixel(arr, 361, 0)).toBeCloseTo(5.651356, precision)
#       expect(image.getPixel(arr, 362, 0)).toBeCloseTo(6.458693, precision)
#       expect(image.getPixel(arr, 363, 0)).toBeCloseTo(3.633014, precision)
#       expect(image.getPixel(arr, 364, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 365, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 366, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 367, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 368, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 369, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 370, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 371, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 372, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 373, 0)).toBeCloseTo(0.807337, precision)
#       expect(image.getPixel(arr, 374, 0)).toBeCloseTo(4.440351, precision)
#       expect(image.getPixel(arr, 375, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 376, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 377, 0)).toBeCloseTo(1.211005, precision)
#       expect(image.getPixel(arr, 378, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 379, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 380, 0)).toBeCloseTo(1.614673, precision)
#       expect(image.getPixel(arr, 381, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 382, 0)).toBeCloseTo(2.422010, precision)
#       expect(image.getPixel(arr, 383, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 384, 0)).toBeCloseTo(-1.614673, precision)
#       expect(image.getPixel(arr, 385, 0)).toBeCloseTo(-2.825678, precision)
#       expect(image.getPixel(arr, 386, 0)).toBeCloseTo(-0.807337, precision)
#       expect(image.getPixel(arr, 387, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 388, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 389, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 390, 0)).toBeCloseTo(-2.422010, precision)
#       expect(image.getPixel(arr, 391, 0)).toBeCloseTo(-1.211005, precision)
#       expect(image.getPixel(arr, 392, 0)).toBeCloseTo(2.018341, precision)
#       expect(image.getPixel(arr, 393, 0)).toBeCloseTo(-2.018341, precision)
#       expect(image.getPixel(arr, 394, 0)).toBeCloseTo(2.825678, precision)
#       expect(image.getPixel(arr, 395, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 396, 0)).toBeCloseTo(3.229346, precision)
#       expect(image.getPixel(arr, 397, 0)).toBeCloseTo(-0.403668, precision)
#       expect(image.getPixel(arr, 398, 0)).toBeCloseTo(0.403668, precision)
#       expect(image.getPixel(arr, 399, 0)).toBeCloseTo(0.000000, precision)
#       expect(image.getPixel(arr, 400, 0)).toBeCloseTo(2.018341, precision)
#       
#   
#   # it 'can decompress gziped data', ->
#   #   
#   #   fits = null
#   # 
#   #   xhr = new XMLHttpRequest()
#   #   xhr.open('GET', 'data/row.fits.fz')
#   #   xhr.responseType = 'arraybuffer'
#   #   xhr.onload = -> fits = new FITS.File(xhr.response)
#   #   xhr.send()
#   #   
#   #   waitsFor -> return fits?
#   # 
#   #   runs ->
#   #     dataunit = fits.getDataUnit()
#   #     dataunit.getFrame()