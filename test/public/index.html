<!DOCTYPE html>
<html>
<head>
  <title>Testing fitsjs</title>
  <link rel="stylesheet" type="text/css" href="/test/lib/jasmine.css">
  <script type="text/javascript" src="/test/lib/jasmine.js"></script>
  <script type="text/javascript" src="/test/lib/jasmine.html.js"></script>

  <script src="/test/lib/jdataview.js" type="text/javascript" charset="utf-8"></script>  
  <script src="/application.js" type="text/javascript" charset="utf-8"></script>
  <script src="/test/specs.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
    for(var key in specs.modules) specs(key);
  </script>

</head>
<body>
  <script type="text/javascript">
    jasmine.getEnv().addReporter(new jasmine.TrivialReporter());
    var fits, compimg, bintable;
    var runTests = false;
    
    var numRequests = 3;
    var requestCount = 0;
    
    window.onload = function () {
      var xhr1 = new XMLHttpRequest();
      xhr1.open('GET', "http://0.0.0.0:9294/data/m101.fits", true)
      xhr1.responseType = 'arraybuffer'
      xhr1.onload = function (e) {
        fits = new FITS.File(xhr1.response);
        requestCount += 1;
        
        if (numRequests === requestCount)
          jasmine.getEnv().execute();
      };
      xhr1.send();
      
      var xhr2 = new XMLHttpRequest();
      xhr2.open('GET', "http://0.0.0.0:9294/data/compressed/CFHTLS_03_g_sci.fits.fz", true)
      xhr2.responseType = 'arraybuffer'
      xhr2.onload = function (e) {
        compimg = new FITS.File(xhr2.response);
        requestCount += 1;
        
        if (numRequests === requestCount)
          jasmine.getEnv().execute();
      };
      xhr2.send();
      
      var xhr3 = new XMLHttpRequest();
      xhr3.open('GET', "http://0.0.0.0:9294/data/spec-0406-51869-0012.fits", true)
      xhr3.responseType = 'arraybuffer'
      xhr3.onload = function (e) {
        bintable = new FITS.File(xhr3.response);
        requestCount += 1;
        
        if (numRequests === requestCount)
          jasmine.getEnv().execute();
      };
      xhr3.send();
      
    };
    
  </script>
</body>
</html>